/**! 
* Masked - v1.0.1 - 
* 
* @author Rashin Sergey 
* @version 1.0.1 2016-08-09
*/
var MaskedObserver=function(){function a(){this.subscribers=[]}return a.prototype={add:function(a){this.subscribers.push(a)},notify:function(){var a=this;Masked.phoneCodes.loadMasks("all",MConf("lang"),function(){a.subscribers.forEach(function(a){a.start()}),Masked.postload()})}},new a}(),$M=MaskedReady=function(){return function(a){this.use=!0,a(),MaskedObserver.notify()}}();$M.ready=$M;var alternativeReady=function(){return{timerID:0,init:function(){this.timerID&&clearTimeout(this.timerID),this.timerID=setTimeout(function(){MaskedObserver.notify()},250)}}}(),generalMaskedFn={extend:function(a,b){var c,d={},e=Object.prototype.hasOwnProperty;for(c in a)a.hasOwnProperty(c)&&e.call(a,c)&&(d[c]=a[c]);for(c in b)b.hasOwnProperty(c)&&e.call(b,c)&&(d[c]=b[c]);return d}},MaskedConfig=MConf=function(){var a={ru:{exceptions:{8975:"7975"}}},b={pathToList:"/js/masks/",prefix:"instId_",lang:"ru",country:"ru",one_country:!1,first_countries:["ru"],exceptions:a,initial_focus:!1,select_range:!1};return function(a){return"string"==typeof a?b[a]:b=generalMaskedFn.extend(b,a)}}(),Masked=function(a,b){function c(){for(var a=arguments,b=a.length,c=0,d=void 0,e=""+d;c!==b;){if(a[c]===d||typeof a[c]===e||null===a[c])return!1;c++}return!0}function d(){for(var a=arguments,b=a.length,c=0,d=0,e=void 0,f=""+e,g=[e,!1,""],h=g.length;c!==b;){for(d=0;h>d;d++)if(typeof a[c]===f||a[c]===g[d]||0===a[c].length)return!0;c++}return!1}function e(a,b){var c=a.className;new RegExp("(^|\\s)"+b+"(\\s|$)","g").test(c)||(a.className=(c+" "+b).replace(/\s+/g," ").replace(/(^ | $)/g,""))}function f(a,b){a.className=a.className.replace(new RegExp("(^|\\s)"+b+"(\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/(^ | $)/g,"")}function g(a,b){for(;(a=a.parentNode)&&a!==b;);return!!a}function h(a){return a.replace(/\D+/g,"")}function i(a,b){var c,d,e=h(a),f=b.split(""),g=0;for(c in f)f.hasOwnProperty(c)&&(d=f[c],"_"==d&&g<e.length&&(f[c]=e[g],g++));return f.join("")}function j(a,b,c){var d="character";if(a.focus(),a.setSelectionRange)a.setSelectionRange(b,c);else if(a.createTextRange){var e=a.createTextRange();e.collapse(!0),e.moveEnd(d,b),e.moveStart(d,c),e.select()}}function k(a){var b,c=a.value;for(b=c.length;b>=0&&!q.test(c[b]);b--);return b}function l(a,b){var c=a.value.split("");c[b]="_",a.value=c.join("")}function m(a,b){var c=!1;for(var d in a)if(a.hasOwnProperty(d)&&a[d].iso_code===b.iso_code&&a[d].lang===b.lang){c=!0;break}return c}function n(a,b){var e,f,g,h,i,j,k,l,m=[],o=!1,p=t,r=p.all;r=p.sortPhones(r,"mask","desc"),d(p[b])||(r=p[b].concat(r));for(e in r)if(r.hasOwnProperty(e)){for(j=r[e].mask,k=!0,f=0,g=0;f<a.length&&g<j.length;){var s=j.charAt(g),u=a.charAt(f);if(q.test(s)||"_"===s){if(!("_"===s&&q.test(u)||u==s)){k=o;break}f++,g++}else g++}k&&f==a.length&&(l=-1==j.substr(g).search(q),j=j.replace(new RegExp([q.source].concat("_").join("|"),"g"),"_"),m.push({mask:j,obj:r[e]}))}"us"!==b&&"ca"!==b||(m=t.sortPhones(m,"obj.mask","asc")),i=o;for(e in m)m.hasOwnProperty(e)&&(h=m[e].obj.mask.replace(/\D+/g,""),parseInt(h)===parseInt(a)&&(i=m[e]));return!i&&m.length>1&&m.sort(function(a,b){return Math.sign((a.mask.match(/_/g)||[]).length-(b.mask.match(/_/g)||[]).length)}),c(m[0])?i||m[0]||o:(a=a.substring(0,a.length-1))?n(a,b):void 0}var o="undefined",p="null",q=new RegExp("[0-9]"),r=function(){function a(a){var b=a||e.event;if(b.isFixed)return b;if(b.isFixed=!0,b.preventDefault=b.preventDefault||function(){this.returnValue=!1},b.stopPropagation=b.stopPropagation||function(){this.cancelBubble=!0},b.target||(b.target=b.srcElement),!b.relatedTarget&&b.fromElement&&(b.relatedTarget=b.fromElement==b.target?b.toElement:b.fromElement),null==b.pageX&&null!=b.clientX){var c=f.documentElement,d=f.body;b.pageX=b.clientX+(c&&c.scrollLeft||d&&d.scrollLeft||0)-(c.clientLeft||0),b.pageY=b.clientY+(c&&c.scrollTop||d&&d.scrollTop||0)-(c.clientTop||0)}return!b.which&&b.button&&(b.which=1&b.button?1:2&b.button?3:4&b.button?2:0),b}function b(b){var c,d=a(b),e=this.events[d.type];for(c in e)if(e.hasOwnProperty(c)){var f=e[c],g=f.call(this,d);g===!1&&(d.preventDefault(),d.stopPropagation())}}var d=0,e=window,f=document;return{add:function(a,f,g){a.setInterval&&a!=e&&!a.frameElement&&(a=e),g.guid||(g.guid=++d),a.events||(a.events={},a.handle=function(d){return c(r)?b.call(a,d):void 0}),a.events[f]||(a.events[f]={},a.addEventListener?a.addEventListener(f,a.handle,!1):a.attachEvent&&a.attachEvent("on"+f,a.handle)),a.events[f][g.guid]=g},remove:function(a,b,c){var d,e=a.events&&a.events[b];if(e){delete e[c.guid];for(d in e)if(e.hasOwnProperty(d))return;a.removeEventListener?a.removeEventListener(b,a.handle,!1):a.detachEvent&&a.detachEvent("on"+b,a.handle),delete a.events[b];for(d in a.events)if(a.events.hasOwnProperty(d))return;try{delete a.handle,delete a.events}catch(f){a.removeAttribute("handle"),a.removeAttribute("events")}}}}}(),s=function(a){var b,e,f,g,h,i,j,k={},l="undefined",m=["GET","POST","PUT"],n=["json","text"],o={},p=XMLHttpRequest,q="Msxml2.XMLHTTP",r={url:a.url||!1,async:a.async||!1,data:a.data||null,crossDomain:a.crossDomain||!1,complete:a.result||function(){},timeout:a.timeout||1e4,type:(-1!==m.indexOf(a.type)?a.type:null)||"GET",dataType:(-1!==n.indexOf(a.dataType)?a.dataType:null)||"json"},s=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")};if(!d(r.url)){if(typeof p==l&&(p=function(){try{var a=ActiveXObject}catch(b){}try{return new a(q+".6.0")}catch(b){}try{return new a(q+".3.0")}catch(b){}try{return new a(q)}catch(b){}throw new Error("This browser does not support XMLHttpRequest.")}),g=new("onload"in new p?p:XDomainRequest),f=r.url,"string"==typeof r.data)try{r.data=JSON.parse(r.data)}catch(t){}"object"==typeof r.data&&(r.data=s(r.data)),"GET"===r.type&&r.data&&r.data.length>0&&(f=r.url+"?"+r.data.toString()),g.open(r.type,f,r.async),r.crossDomain||(o["X-Requested-With"]="XMLHttpRequest");for(b in o)o.hasOwnProperty(b)&&c(o[b])&&g.setRequestHeader(b,o[b]+"");r.data&&r.data.toString().length>0&&(g.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.data=r.data.toString());try{g.send(r.data||null)}catch(t){}if(r.async)var u=setTimeout(function(){g.abort()},r.timeout);j=function(){if(4===g.readyState)if(r.async&&clearTimeout(u),j="undefined",4!==g.readyState)g.abort();else{h=g.status,"string"==typeof g.responseText&&(k.text=g.responseText);try{i=g.statusText}catch(a){i=""}h||r.crossDomain?1223===h&&(h=204):h=k.text?200:404}if(k&&(h||r.crossDomain?1223===h&&(h=204):h=k.text?200:404,200===h)){if("text"===r.dataType)e=k.text||"";else if("json"===r.dataType)try{e=JSON.parse(k.text)||""}catch(a){e=""}r.complete(e,h,i,g.getAllResponseHeaders())}},r.async?4===g.readyState?setTimeout(j,20):g.onreadystatechange=j:j()}},t={all:[],ae:[],an:[],ba:[],bt:[],ca:[],cn:[],de:[],ec:[],ee:[],id:[],il:[],jp:[],kp:[],la:[],lb:[],ly:[],mc:[],mm:[],mx:[],my:[],ng:[],nz:[],ru:[],sa:[],sb:[],so:[],sr:[],th:[],tl:[],tv:[],tw:[],ua:[],us:[],vn:[],vu:[],ye:[],sortPhones:function(a,b,d){var e="mask",f="desc",g="asc",h=b==e?e:"name",i=d==f?f:g;return a&&a.sort(function(a,b){return c(a[h])&&c(b[h])?(h===e?(a=a[h].replace(/\D+/g,""),b=b[h].replace(/\D+/g,"")):(a=a[h],b=b[h]),a>b?i==g?1:-1:b>a?i==g?-1:1:0):c(a[h])?-1:1}),a},loadMasks:function(a,b,c){var e=this,f=!0;s({url:MConf("pathToList")+a+"/"+(d(b)?"ru":b)+".min.json",type:"GET",async:f,crossDomain:f,dataType:"json",result:function(b){e[a]=e.sortPhones(b,"mask","desc"),"function"==typeof c&&c()}})},findMaskByCode:function(a){var b,c,d=this,e=d.sortPhones(d.all,"name",1);for(b in d.all)if(d.all.hasOwnProperty(b)&&(c=e[b],c.iso_code===a))return c;return!1}},u={text:null,focus:function(a){Masked.getInst(this).focused()},dblclick:function(){this.click()},click:function(){var a=Masked.getInst(this);a.opt.select_range!==!1?a.setRange():a.focused()},mouseup:function(){},blur:function(){var a=Masked.getInst(this);a.opt.select_range!==!1&&a.unsetRange()},keydown:function(a){var b,c,d=this,e=x,f=e.getInst(d),g=a.which||a.keyCode,h=a.ctrlKey||a.metaKey,i=a.key?a.key:g>=96&&105>=g?String.fromCharCode(g-48):String.fromCharCode(g),m=d.value,n=f.opt.select_range,o=!1,p=!0;return 8===g?(b=k(d),q.test(m[b])===p?(n!==!1&&n.focus===!0&&(f.replaceRange(),b=n.start,f.unsetRange(),f.opt.select_range.changed=n.end-n.start>1),l(d,b),j(d,b,b),f.setMask(d),f.focused(),o):o):h===!0&&86===g?p:(c=m.indexOf("_"),n!==!1&&n.focus===!0&&(f.replaceRange(),c=n.start,m=d.value,f.unsetRange(),f.opt.select_range.changed=n.end-n.start>1),-1===c?f.ifIssetNextMask()&&q.test(i)===p?p:o:q.test(i)!==p||"_"!==m[c]?o:void j(d,c,c+1))},keyup:function(a){var b,c,d=this,e=x,f=e.getInst(d),g=a.keyCode||a.which,h=d.value,i=f.opt,j=!1;return 8===g?(b=k(d),q.test(h[b])===!0?(b+=1,f.focused(),j):j):void(13===g?i.onsend&&i.onsend(i):(c=h.indexOf("_"),b=-1!==c?c:h.length,f.setMask(d),f.focused()))},paste:function(a){a.preventDefault();var b=this,c=x,d=c.getInst(b),e=(a.originalEvent||a).clipboardData.getData("text/plain");d.opt.element.value=h(e),d.setMask(b)}},v=function(a,b){var c=this,d=function(a,b){var d,f;if(b.phone){var g=c.maskFinder(b.phone);g||(b.phone=!1)}e(c.opt.element,c.opt.instId),c.opt.oldState=a.outerHTML,c.setTemplate(),f=c.opt,d=c.opt.element,d.value=f.value,d.placeholder=f.value,c.addActions(f.element)},f=function(){for(var a="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;8>c;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a};c.opt={listOpened:!1,instId:MConf("prefix")+f(),element:a,lang:b.lang,country:b.country||MConf("country"),phone:b.phone||!1,mask:b.mask||"",onsend:b.onsend||null,one_country:b.one_country||MConf("one_country"),first_countries:b.first_countries||MConf("first_countries"),exceptions:b.exceptions||MConf("exceptions"),value:"",name:"",old:{},oldState:null,initial_focus:b.initial_focus||MConf("initial_focus"),select_range:b.select_range||MConf("select_range")?{focus:!1,changed:!1,start:0,end:0}:!1},d(a,c.opt)};v.prototype={setMask:function(a){this.maskFinder(a.value,this.opt.country)},maskFinder:function(a,b){var e,f,g,j=this,k=w,l=k.countries,o=h(a+""),p=b?b:!1,q=t,r=j.opt.one_country,s=j.opt.exceptions,u=!1;if(o){if(!d(s[p])&&!d(s[p].exceptions)){var v=s[p].exceptions,x=q.findMaskByCode(p).phone_code;for(var y in v)if(v.hasOwnProperty(y)&&o===x+""+y){o=o.replace(x+""+y,x+""+v[y]);break}}}else{if(r===!1)return!1;(g=q.findMaskByCode(r))&&(o=h(g.mask))}if(g=n(o,p)){if(f=g.obj,e=f.iso_code,r!==u&&r.toString().toLowerCase()!==e)return!1;if(c(q[e])&&d(q[e])){var z={iso_code:e,lang:j.opt.lang};m(l,z)||(l.push(z),k.initialization===u&&q.loadMasks(e,j.opt.lang,function(){g=n(o,e),j.setInp(j.opt.element,g.obj.iso_code,g.obj.name,i(o,g.mask)),j.opt.initial_focus===!0&&j.focused()})),j.setInp(j.opt.element,g.obj.iso_code,g.obj.name,i(o,g.mask))}else c(q[e])&&!d(q[e])&&p!==u&&(g=n(o,e)),o=j.opt.select_range.changed===!0&&-1!==a.indexOf("_")?a:i(o,g.mask),j.setInp(j.opt.element,f.iso_code,f.name,o)}return j.opt.initial_focus===!0&&j.focused(),g},setTemplate:function(){var a,b,d,h,i,j,k,l,m,n,o,p,q=this,s=window,u=document,v=q.opt,w=v.element,x="lists",y="active",z="top",A="CBH-masks",B=q.opt.one_country,C=q.opt.first_countries,D=u.getElementsByClassName(x+" "+y),E=function(a){return document.createElement(a)},F=function(a,b){a.innerHTML=b.outerHTML},G=function(a,b){return a.className=b},H=t,I=function(a,b){a.appendChild(b)},J="div",K="flag";if(m=E("div"),F(m,w),G(m,A),w.parentNode.replaceChild(m,w),B||(k=E("i"),G(k,"caret")),j=E(J),B||F(j,k),G(j,K+" "+v.country),n=E(J),F(n,j),G(n,"selected"),B?(o=E(J),F(o,n),G(o,"country")):(o=E(J),F(o,n),G(o,"flags"),d=E("ul"),G(d,"lists")),p=H.sortPhones(H.all,"name","asc"),0!==p.length){var L=function(){var e=p[a],f=e.iso_code.toString().toLowerCase(),g=e.name,j=e.mask;return c(g)?(v.phone===!1&&v.country===f&&(q.opt.name=g,q.opt.mask=j,q.opt.value=j),void(B||(b=E("li"),b.className="country",b.dataset.isoCode=f,b.dataset.mask=j,r.add(b,"click",q.maskReplace),h=E("i"),G(h,K+" "+f),I(b,h),i=E("span"),G(i,"name"),i.innerHTML=g,I(b,i),i=E("span"),G(i,"code"),i.innerHTML="+"+e.phone_code,I(b,i),I(d,b)))):!1};if(!B){for(a in p)!p.hasOwnProperty(a)||-1===C.indexOf(p[a].iso_code)||L()!==!1;var M=E("hr");I(d,M)}for(a in p)!p.hasOwnProperty(a)||L()!==!1;B||(I(o,d),r.add(d,"mousedown",function(a){a.stopPropagation()})),m.insertBefore(o,m.firstChild),B||(m.getElementsByClassName("selected")[0].onclick=function(){function b(a){var b=0,c=0;if(a&&a.offsetParent)do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return{left:b,top:c}}l=m.getElementsByClassName(x)[0];var c=document,d=function(a){g(a.target,o)||(f(l,y),f(l,z),r.remove(c,"click",d))};if(D.length)for(a in D)D.hasOwnProperty(a)&&l!==D[a]&&f(D[a],y);if(/active/.test(l.className)!==!0){r.add(c,"click",d),e(l,y);var h=s.innerHeight||u.documentElement.clientHeight||u.body.clientHeight,i=b(l),j=i.top-l.scrollTop,k=l.clientHeight;h-(j+m.childNodes[1].clientHeight)<=k&&e(l,z)}else f(l,y),f(l,z),r.remove(c,"click",d)}),q.opt.element=m.childNodes[1]}},setInp:function(a,b,c,e){var f,g=this.opt;d(a.parentNode.getElementsByClassName("selected")[0])||(f=a.parentNode.getElementsByClassName("selected")[0].getElementsByClassName("flag")[0],f.className="flag "+b,f.parentNode.setAttribute("title",c)),g.country=b,g.name=c,g.value=e,g.mask=e,a.value=e},focused:function(){var a=this,b=(a.opt,a.opt.element),c=b.value,d=c.indexOf("_"),e=-1===d?c.length:d;j(b,e,e)},setRange:function(){var a=this,b=a.opt,c=a.opt.element,d=c.selectionStart,e=c.selectionEnd;d!==e&&(b.select_range={focus:!0,changed:!1,start:d,end:e})},unsetRange:function(){this.opt.select_range={focus:!1,changed:!1,start:0,end:0}},replaceRange:function(){var a=this;a.opt,a.opt.element;value=a.opt.element.value.split(""),selected=a.opt.select_range;for(var b in value)value.hasOwnProperty(b)&&b>=selected.start&&b<selected.end&&q.test(value[b])&&(value[b]="_");a.opt.element.value=value.join("")},blured:function(){this.opt.element.blur()},maskReplace:function(){var a=this,b=t,c=a.parentNode.parentNode,d=c.parentNode.childNodes[1],e=Masked.getInst(d),g=a.dataset,j=b.findMaskByCode(e.opt.country),k=b.findMaskByCode(g.isoCode);e.setInp(e.opt.element,k.iso_code,k.name,i(h(d.value).replace(j.phone_code,k.phone_code),k.mask.replace(new RegExp([q.source].concat("_").join("|"),"g"),"_"))),f(c.childNodes[1],"active")},ifIssetNextMask:function(){var a=this,b=a.opt.country,d=t,e=a.opt.element.value,f=e.replace(new RegExp([q.source].concat("_").join("|"),"g"),"_").replace(/[+()-]/g,"").length;if(c(d[b]))for(var g in d[b])if(d[b].hasOwnProperty(g)){var h=d[b][g].mask.replace(new RegExp([q.source].concat("_").join("|"),"g"),"_").replace(/[0-9+()-]/g,"").length;if(h>f)return!0}return!1},addActions:function(a){r.add(a,"focus",u.focus),r.add(a,"blur",u.blur),r.add(a,"click",u.click),r.add(a,"dblclick",u.dblclick),r.add(a,"keydown",u.keydown),r.add(a,"keyup",u.keyup),r.add(a,"paste",u.paste),r.add(a,"mouseup",u.mouseup)}};var w={initialization:!0,instances:[],countries:[]},x=function(a){var b=this;return b.elements=[],b.options={lang:MConf("lang"),country:MConf("country")},b.init(a),typeof MaskedReady.use===o&&alternativeReady.init(),b};return x.postload=function(){var a,b,e,f,g=t,h=w,i=h.instances,j=h.countries;for(a in j)j.hasOwnProperty(a)&&(f=j[a],c(g[f.iso_code])&&d(g[f.iso_code])&&g.loadMasks(f.iso_code,f.lang,function(){for(a in i)i.hasOwnProperty(a)&&(e=i[a],b={iso_code:e.opt.country,lang:e.opt.lang},m(j,b)&&e.maskFinder(e.opt.phone,e.opt.country))}));h.initialization=!1},x.getInst=function(a){return w.instances[a.className.match(new RegExp(MConf("prefix")+"[0-9a-zA-Z]+"))]},x.phoneCodes=t,x.getById=function(a){var b=document.getElementById(a);return null!==b?this.getInst(b):!1},x.toggle=function(a){var b=this.getInst(a),c=b.opt;d(a.parentNode)||"CBH-masks"!==a.parentNode.className?(c.element=a,b.setTemplate(),c.element.value=c.value,b.addActions(c.element)):a.parentNode.outerHTML=c.oldState},x.prototype={init:function(b){function c(b){var c,d,e,f=[],g=b.selector;if("string"==typeof g)if(e=g[0],"."!==e&&"#"!==e||(g=g.substr(1)),"."===e){d=a.getElementsByClassName(g);for(c in d)d.hasOwnProperty(c)&&d[c]!==p&&(f[d[c].id||c]=d[c])}else"#"===e?(d=a.getElementById(g),d!==p&&f.push(d)):console.log("selector finder empty");else g.nodeType&&g!==p&&f.push(g);return f}var d=this;return b&&("string"==typeof b&&(b={selector:b}),d.options=generalMaskedFn.extend(d.options,b)),typeof b.selector!==o&&(d.elements=c(b)),Object.keys(d.elements).length&&MaskedObserver.add(d),d},start:function(){var a,b,c,d,e=this,f=e.elements;for(a in f)f.hasOwnProperty(a)&&(b=f[a],b.className.match(new RegExp(MConf("prefix")+"[0-9a-zA-Z]+"))||(c=generalMaskedFn.extend(generalMaskedFn.extend({},e.options),b.dataset),d=new v(b,c),w.instances[d.opt.instId]=d))}},x}(document,window);