/**! 
* Masked - v1.0.1 - 
* 
* @author Rashin Sergey 
* @version 1.0.1 2016-05-31
*/
var MaskedObserver=function(){function a(){this.subscribers=[]}return a.prototype={add:function(a){this.subscribers.push(a)},notify:function(){var a=this;Masked.phoneCodes.loadMasks("all",MConf("lang"),function(){a.subscribers.forEach(function(a){a.start()}),Masked.postload()})}},new a}(),$M=MaskedReady=function(){return function(a){this.use=!0,a(),MaskedObserver.notify()}}();$M.ready=$M;var alternativeReady=function(){return{timerID:0,init:function(){this.timerID&&clearTimeout(this.timerID),this.timerID=setTimeout(function(){MaskedObserver.notify()},250)}}}(),generalMaskedFn={extend:function(a,b){var c,d={},e=Object.prototype.hasOwnProperty;for(c in a)a.hasOwnProperty(c)&&e.call(a,c)&&(d[c]=a[c]);for(c in b)b.hasOwnProperty(c)&&e.call(b,c)&&(d[c]=b[c]);return d}},MaskedConfig=MConf=function(){var a={ru:{exceptions:{8975:"7975"}}},b={pathToList:"//masked.proj/js/masks/",prefix:"instId_",lang:"ru",country:"ru",one_country:!1,first_countries:["ru"],exceptions:a};return function(a){return"string"==typeof a?b[a]:generalMaskedFn.extend(b,a)}}(),Masked=function(a){function b(){for(var a=arguments,b=a.length,c=0,d=void 0,e=""+d;c!==b;){if(a[c]===d||typeof a[c]===e||null===a[c])return!1;c++}return!0}function c(){for(var a=arguments,b=a.length,c=0,d=0,e=void 0,f=""+e,g=[e,!1,""],h=g.length;c!==b;){for(d=0;h>d;d++)if(typeof a[c]===f||a[c]===g[d]||0===a[c].length)return!0;c++}return!1}function d(a,b){var c=a.className;new RegExp("(^|\\s)"+b+"(\\s|$)","g").test(c)||(a.className=(c+" "+b).replace(/\s+/g," ").replace(/(^ | $)/g,""))}function e(a,b){a.className=a.className.replace(new RegExp("(^|\\s)"+b+"(\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/(^ | $)/g,"")}function f(a,b){for(;(a=a.parentNode)&&a!==b;);return!!a}function g(a){return a.replace(/\D+/g,"")}function h(a,b){var c,d,e=g(a),f=b.split(""),h=0;for(c in f)f.hasOwnProperty(c)&&(d=f[c],"_"==d&&h<e.length&&(f[c]=e[h],h++));return f.join("")}function i(a,b,c){var d="character";if(a.focus(),a.setSelectionRange)a.setSelectionRange(b,c);else if(a.createTextRange){var e=a.createTextRange();e.collapse(!0),e.moveEnd(d,b),e.moveStart(d,c),e.select()}}function j(a){var b,c=a.value;for(b=c.length;b>=0&&!p.test(c[b]);b--);return b}function k(a,b){var c=a.value.split("");c[b]="_",a.value=c.join("")}function l(a,b){var c=!1;for(var d in a)if(a.hasOwnProperty(d)&&a[d].iso_code===b.iso_code&&a[d].lang===b.lang){c=!0;break}return c}function m(a,d){var e,f,g,h,i,j,k,l,n=[],o=!1,q=s,r=q.all;r=q.sortPhones(r,"mask","desc"),c(q[d])||(r=q[d].concat(r));for(e in r)if(r.hasOwnProperty(e)){for(j=r[e].mask,k=!0,f=0,g=0;f<a.length&&g<j.length;){var t=j.charAt(g),u=a.charAt(f);if(p.test(t)||"_"===t){if(!("_"===t&&p.test(u)||u==t)){k=o;break}f++,g++}else g++}k&&f==a.length&&(l=-1==j.substr(g).search(p),j=j.replace(new RegExp([p.source].concat("_").join("|"),"g"),"_"),n.push({mask:j,obj:r[e]}))}"us"!==d&&"ca"!==d||(n=s.sortPhones(n,"obj.mask","asc")),i=o;for(e in n)n.hasOwnProperty(e)&&(h=n[e].obj.mask.replace(/\D+/g,""),parseInt(h)===parseInt(a)&&(i=n[e]));return!i&&n.length>1&&n.sort(function(a,b){return Math.sign((a.mask.match(/_/g)||[]).length-(b.mask.match(/_/g)||[]).length)}),b(n[0])?i||n[0]||o:(a=a.substring(0,a.length-1))?m(a,d):void 0}var n="undefined",o="null",p=new RegExp("[0-9]"),q=function(){function a(a){var b=a||e.event;if(b.isFixed)return b;if(b.isFixed=!0,b.preventDefault=b.preventDefault||function(){this.returnValue=!1},b.stopPropagation=b.stopPropagation||function(){this.cancelBubble=!0},b.target||(b.target=b.srcElement),!b.relatedTarget&&b.fromElement&&(b.relatedTarget=b.fromElement==b.target?b.toElement:b.fromElement),null==b.pageX&&null!=b.clientX){var c=f.documentElement,d=f.body;b.pageX=b.clientX+(c&&c.scrollLeft||d&&d.scrollLeft||0)-(c.clientLeft||0),b.pageY=b.clientY+(c&&c.scrollTop||d&&d.scrollTop||0)-(c.clientTop||0)}return!b.which&&b.button&&(b.which=1&b.button?1:2&b.button?3:4&b.button?2:0),b}function c(b){var c,d=a(b),e=this.events[d.type];for(c in e)if(e.hasOwnProperty(c)){var f=e[c],g=f.call(this,d);g===!1&&(d.preventDefault(),d.stopPropagation())}}var d=0,e=window,f=document;return{add:function(a,f,g){a.setInterval&&a!=e&&!a.frameElement&&(a=e),g.guid||(g.guid=++d),a.events||(a.events={},a.handle=function(d){return b(q)?c.call(a,d):void 0}),a.events[f]||(a.events[f]={},a.addEventListener?a.addEventListener(f,a.handle,!1):a.attachEvent&&a.attachEvent("on"+f,a.handle)),a.events[f][g.guid]=g},remove:function(a,b,c){var d,e=a.events&&a.events[b];if(e){delete e[c.guid];for(d in e)if(e.hasOwnProperty(d))return;a.removeEventListener?a.removeEventListener(b,a.handle,!1):a.detachEvent&&a.detachEvent("on"+b,a.handle),delete a.events[b];for(d in a.events)if(a.events.hasOwnProperty(d))return;try{delete a.handle,delete a.events}catch(f){a.removeAttribute("handle"),a.removeAttribute("events")}}}}}(),r=function(a){var d,e,f,g,h,i,j,k={},l="undefined",m=["GET","POST","PUT"],n=["json","text"],o={},p=XMLHttpRequest,q="Msxml2.XMLHTTP",r={url:a.url||!1,async:a.async||!1,data:a.data||null,crossDomain:a.crossDomain||!1,complete:a.result||function(){},timeout:a.timeout||1e4,type:(-1!==m.indexOf(a.type)?a.type:null)||"GET",dataType:(-1!==n.indexOf(a.dataType)?a.dataType:null)||"json"},s=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")};if(!c(r.url)){if(typeof p==l&&(p=function(){try{var a=ActiveXObject}catch(b){}try{return new a(q+".6.0")}catch(b){}try{return new a(q+".3.0")}catch(b){}try{return new a(q)}catch(b){}throw new Error("This browser does not support XMLHttpRequest.")}),g=new("onload"in new p?p:XDomainRequest),f=r.url,"string"==typeof r.data)try{r.data=JSON.parse(r.data)}catch(t){}"object"==typeof r.data&&(r.data=s(r.data)),"GET"===r.type&&r.data&&r.data.length>0&&(f=r.url+"?"+r.data.toString()),g.open(r.type,f,r.async),r.crossDomain||(o["X-Requested-With"]="XMLHttpRequest");for(d in o)o.hasOwnProperty(d)&&b(o[d])&&g.setRequestHeader(d,o[d]+"");r.data&&r.data.toString().length>0&&(g.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.data=r.data.toString());try{g.send(r.data||null)}catch(t){}if(r.async)var u=setTimeout(function(){g.abort()},r.timeout);j=function(){if(4===g.readyState)if(r.async&&clearTimeout(u),j="undefined",4!==g.readyState)g.abort();else{h=g.status,"string"==typeof g.responseText&&(k.text=g.responseText);try{i=g.statusText}catch(a){i=""}h||r.crossDomain?1223===h&&(h=204):h=k.text?200:404}if(k&&(h||r.crossDomain?1223===h&&(h=204):h=k.text?200:404,200===h)){if("text"===r.dataType)e=k.text||"";else if("json"===r.dataType)try{e=JSON.parse(k.text)||""}catch(a){e=""}r.complete(e,h,i,g.getAllResponseHeaders())}},r.async?4===g.readyState?setTimeout(j,20):g.onreadystatechange=j:j()}},s={all:[],ae:[],an:[],ba:[],bt:[],ca:[],cn:[],de:[],ec:[],ee:[],id:[],il:[],jp:[],kp:[],la:[],lb:[],ly:[],mc:[],mm:[],mx:[],my:[],ng:[],nz:[],ru:[],sa:[],sb:[],so:[],sr:[],th:[],tl:[],tv:[],tw:[],ua:[],us:[],vn:[],vu:[],ye:[],sortPhones:function(a,c,d){var e="mask",f="desc",g="asc",h=c==e?e:"name",i=d==f?f:g;return a.sort(function(a,c){return b(a[h])&&b(c[h])?(h===e?(a=a[h].replace(/\D+/g,""),c=c[h].replace(/\D+/g,"")):(a=a[h],c=c[h]),a>c?i==g?1:-1:c>a?i==g?-1:1:0):b(a[h])?-1:1}),a},loadMasks:function(a,b,d){var e=this,f=!0;r({url:MConf("pathToList")+a+"/"+(c(b)?"ru":b)+".min.json",type:"GET",async:f,crossDomain:f,dataType:"json",result:function(b){e[a]=e.sortPhones(b,"mask","desc"),"function"==typeof d&&d()}})},findMaskByCode:function(a){var b,c,d=this,e=d.sortPhones(d.all,"name",1);for(b in d.all)if(d.all.hasOwnProperty(b)&&(c=e[b],c.iso_code===a))return c;return!1}},t={focus:function(){Masked.getInst(this).focused()},click:function(){Masked.getInst(this).focused()},keydown:function(a){var b,c,d=this,e=w,f=e.getInst(d),g=a.which||a.keyCode,h=a.ctrlKey||a.metaKey,l=a.key?a.key:g>=96&&105>=g?String.fromCharCode(g-48):String.fromCharCode(g),m=d.value,n=!1,o=!0;return 8===g?(b=j(d),p.test(m[b])===o?(k(d,b),i(d,b,b),f.setMask(d),n):n):h===!0&&86===g?o:(c=m.indexOf("_"),-1===c?f.ifIssetNextMask()&&p.test(l)===o?o:n:p.test(l)!==o?n:void i(d,c,c+1))},keyup:function(a){var b,c,d=this,e=w,f=e.getInst(d),g=a.keyCode||a.which,h=d.value,k=f.opt,l=!1;return 8===g?(b=j(d),p.test(h[b])===!0?(b+=1,i(d,b,b),l):l):void(13===g?k.onsend&&k.onsend(k):(c=h.indexOf("_"),b=-1!==c?c:h.length,i(d,b,b),f.setMask(d)))},paste:function(a){a.preventDefault();var b=this,c=w,d=c.getInst(b),e=(a.originalEvent||a).clipboardData.getData("text/plain");d.opt.element.value=g(e),d.setMask(b)}},u=function(a,b){var c=this,e=function(a,b){var e,f;if(b.phone){var g=c.maskFinder(b.phone);g||(b.phone=!1)}d(c.opt.element,c.opt.instId),c.opt.oldState=a.outerHTML,c.setTemplate(),f=c.opt,e=c.opt.element,e.value=f.value,e.placeholder=f.value,c.addActions(f.element)},f=function(){for(var a="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;8>c;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a};c.opt={listOpened:!1,instId:MConf("prefix")+f(),element:a,lang:b.lang,country:b.country||MConf("country"),phone:b.phone||!1,mask:b.mask||"",onsend:b.onsend||null,one_country:b.one_country||MConf("one_country"),first_countries:b.first_countries||MConf("first_countries"),exceptions:b.exceptions||MConf("exceptions"),value:"",name:"",old:{},oldState:null},e(a,c.opt)};u.prototype={setMask:function(a){this.maskFinder(a.value,this.opt.country)},maskFinder:function(a,d){var e,f,i,j=this,k=v,n=k.countries,o=g(a+""),p=d?d:!1,q=s,r=j.opt.one_country,t=j.opt.exceptions,u=!1;if(o){if(!c(t[p])&&!c(t[p].exceptions)){var w=t[p].exceptions,x=q.findMaskByCode(p).phone_code;for(var y in w)if(w.hasOwnProperty(y)&&o===x+""+y){o=o.replace(x+""+y,x+""+w[y]);break}}}else{if(r===!1)return!1;(i=q.findMaskByCode(r))&&(o=g(i.mask))}if(i=m(o,p)){if(f=i.obj,e=f.iso_code,r!==u&&r.toString().toLowerCase()!==e)return!1;if(b(q[e])&&c(q[e])){var z={iso_code:e,lang:j.opt.lang};l(n,z)||(n.push(z),k.initialization===u&&q.loadMasks(e,j.opt.lang,function(){i=m(o,e),j.setInp(j.opt.element,i.obj.iso_code,i.obj.name,h(o,i.mask)),j.focused()})),j.setInp(j.opt.element,i.obj.iso_code,i.obj.name,h(o,i.mask))}else b(q[e])&&!c(q[e])&&p!==u&&(i=m(o,e)),j.setInp(j.opt.element,f.iso_code,f.name,h(o,i.mask))}return j.focused(),i},setTemplate:function(){var a,c,g,h,i,j,k,l,m,n,o,p,r=this,t=window,u=document,v=r.opt,w=v.element,x="lists",y="active",z="top",A="CBH-masks",B=r.opt.one_country,C=r.opt.first_countries,D=u.getElementsByClassName(x+" "+y),E=function(a){return document.createElement(a)},F=function(a,b){a.innerHTML=b.outerHTML},G=function(a,b){return a.className=b},H=s,I=function(a,b){a.appendChild(b)},J="div",K="flag";if(m=E("div"),F(m,w),G(m,A),w.parentNode.replaceChild(m,w),B||(k=E("i"),G(k,"caret")),j=E(J),B||F(j,k),G(j,K+" "+v.country),n=E(J),F(n,j),G(n,"selected"),B?(o=E(J),F(o,n),G(o,"country")):(o=E(J),F(o,n),G(o,"flags"),g=E("ul"),G(g,"lists")),p=H.sortPhones(H.all,"name","asc"),0!==p.length){var L=function(){var d=p[a],e=d.iso_code.toString().toLowerCase(),f=d.name,j=d.mask;return b(f)?(v.phone===!1&&v.country===e&&(r.opt.name=f,r.opt.mask=j,r.opt.value=j),void(B||(c=E("li"),c.className="country",c.dataset.isoCode=e,c.dataset.mask=j,q.add(c,"click",r.maskReplace),h=E("i"),G(h,K+" "+e),I(c,h),i=E("span"),G(i,"name"),i.innerHTML=f,I(c,i),i=E("span"),G(i,"code"),i.innerHTML="+"+d.phone_code,I(c,i),I(g,c)))):!1};if(!B){for(a in p)!p.hasOwnProperty(a)||-1===C.indexOf(p[a].iso_code)||L()!==!1;var M=E("hr");I(g,M)}for(a in p)!p.hasOwnProperty(a)||L()!==!1;B||(I(o,g),q.add(g,"mousedown",function(a){a.stopPropagation()})),m.insertBefore(o,m.firstChild),B||(m.getElementsByClassName("selected")[0].onclick=function(){function b(a){var b=0,c=0;if(a&&a.offsetParent)do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return{left:b,top:c}}l=m.getElementsByClassName(x)[0];var c=document,g=function(a){f(a.target,o)||(e(l,y),e(l,z),q.remove(c,"click",g))};if(D.length)for(a in D)D.hasOwnProperty(a)&&l!==D[a]&&e(D[a],y);if(/active/.test(l.className)!==!0){q.add(c,"click",g),d(l,y);var h=t.innerHeight||u.documentElement.clientHeight||u.body.clientHeight,i=b(l),j=i.top-l.scrollTop,k=l.clientHeight;h-(j+m.childNodes[1].clientHeight)<=k&&d(l,z)}else e(l,y),e(l,z),q.remove(c,"click",g)}),r.opt.element=m.childNodes[1]}},setInp:function(a,b,d,e){var f,g=this.opt;c(a.parentNode.getElementsByClassName("selected")[0])||(f=a.parentNode.getElementsByClassName("selected")[0].getElementsByClassName("flag")[0],f.className="flag "+b,f.parentNode.setAttribute("title",d)),g.country=b,g.name=d,g.value=e,g.mask=e,a.value=e},focused:function(){var a=this,b=a.opt.element,c=b.value,d=c.indexOf("_"),e=-1===d?c.length:d;i(b,e,e)},maskReplace:function(){var a=this,b=s,c=a.parentNode.parentNode,d=c.parentNode.childNodes[1],f=Masked.getInst(d),i=a.dataset,j=b.findMaskByCode(f.opt.country),k=b.findMaskByCode(i.isoCode);f.setInp(f.opt.element,k.iso_code,k.name,h(g(d.value).replace(j.phone_code,k.phone_code),k.mask.replace(new RegExp([p.source].concat("_").join("|"),"g"),"_"))),e(c.childNodes[1],"active")},ifIssetNextMask:function(){var a=this,c=a.opt.country,d=s,e=a.opt.element.value,f=e.replace(new RegExp([p.source].concat("_").join("|"),"g"),"_").replace(/[+()-]/g,"").length;if(b(d[c]))for(var g in d[c])if(d[c].hasOwnProperty(g)){var h=d[c][g].mask.replace(new RegExp([p.source].concat("_").join("|"),"g"),"_").replace(/[0-9+()-]/g,"").length;if(h>f)return!0}return!1},addActions:function(a){q.add(a,"focus",t.focus),q.add(a,"click",t.click),q.add(a,"keydown",t.keydown),q.add(a,"keyup",t.keyup),q.add(a,"paste",t.paste)}};var v={initialization:!0,instances:[],countries:[]},w=function(a){var b=this;return b.elements=[],b.options={lang:MConf("lang"),country:MConf("country")},b.init(a),typeof MaskedReady.use===n&&alternativeReady.init(),b};return w.postload=function(){var a,d,e,f=s,g=v,h=g.instances,i=g.countries;for(a in i)i.hasOwnProperty(a)&&(e=i[a],b(f[e.iso_code])&&c(f[e.iso_code])&&f.loadMasks(e.iso_code,e.lang,function(){for(a in h){d=h[a];var b={iso_code:d.opt.country,lang:d.opt.lang};h.hasOwnProperty(a)&&l(i,b)&&d.maskFinder(d.opt.phone,d.opt.country)}}));g.initialization=!1},w.getInst=function(a){return v.instances[a.className.match(new RegExp(MConf("prefix")+"[0-9a-zA-Z]+"))]},w.phoneCodes=s,w.getById=function(a){var b=document.getElementById(a);return null!==b?this.getInst(b):!1},w.toggle=function(a){var b=this.getInst(a),d=b.opt;c(a.parentNode)||"CBH-masks"!==a.parentNode.className?(d.element=a,b.setTemplate(),d.element.value=d.value,b.addActions(d.element)):a.parentNode.outerHTML=d.oldState},w.prototype={init:function(b){function c(b){var c,d,e,f=[],g=b.selector;if("string"==typeof g)if(e=g[0],"."!==e&&"#"!==e||(g=g.substr(1)),"."===e){d=a.getElementsByClassName(g);for(c in d)d.hasOwnProperty(c)&&d[c]!==o&&(f[d[c].id||c]=d[c])}else"#"===e?(d=a.getElementById(g),d!==o&&f.push(d)):console.log("selector finder empty");else g.nodeType&&g!==o&&f.push(g);return f}var d=this;return b&&("string"==typeof b&&(b={selector:b}),d.options=generalMaskedFn.extend(d.options,b)),typeof b.selector!==n&&(d.elements=c(b)),Object.keys(d.elements).length&&MaskedObserver.add(d),d},start:function(){var a,b,c,d,e=this,f=e.elements;for(a in f)f.hasOwnProperty(a)&&(b=f[a],b.className.match(new RegExp(MConf("prefix")+"[0-9a-zA-Z]+"))||(c=generalMaskedFn.extend(generalMaskedFn.extend({},e.options),b.dataset),d=new u(b,c),v.instances[d.opt.instId]=d))}},w}(document);