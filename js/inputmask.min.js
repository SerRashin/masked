var CBHMasks=function(){function a(a,b){var c=a.className;new RegExp("(^|\\s)"+b+"(\\s|$)","g").test(c)||(a.className=(c+" "+b).replace(/\s+/g," ").replace(/(^ | $)/g,""))}function b(a,b){a.className=a.className.replace(new RegExp("(^|\\s)"+b+"(\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/(^ | $)/g,"")}function c(){for(var a="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;8>c;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a}function d(){for(var a=arguments,b=a.length,c=0,d=void 0,e=""+d;c!==b;){if(a[c]===d||typeof a[c]===e||null===a[c])return!1;c++}return!0}function e(){for(var a=arguments,b=a.length,c=0,d=0,e=void 0,f=""+e,g=[e,!1,""],h=g.length;c!==b;){for(d=0;h>d;d++)if(typeof a[c]===f||a[c]===g[d]||0===a[c].length)return!0;c++}return!1}var f="undefined",g=function(){function a(a){var b=a||e.event;if(b.isFixed)return b;if(b.isFixed=!0,b.preventDefault=b.preventDefault||function(){this.returnValue=!1},b.stopPropagation=b.stopPropagation||function(){this.cancelBubble=!0},b.target||(b.target=b.srcElement),!b.relatedTarget&&b.fromElement&&(b.relatedTarget=b.fromElement==b.target?b.toElement:b.fromElement),null==b.pageX&&null!=b.clientX){var c=f.documentElement,d=f.body;b.pageX=b.clientX+(c&&c.scrollLeft||d&&d.scrollLeft||0)-(c.clientLeft||0),b.pageY=b.clientY+(c&&c.scrollTop||d&&d.scrollTop||0)-(c.clientTop||0)}return!b.which&&b.button&&(b.which=1&b.button?1:2&b.button?3:4&b.button?2:0),b}function b(b){var c,d=a(b),e=this.events[d.type];for(c in e)if(e.hasOwnProperty(c)){var f=e[c],g=f.call(this,d);g===!1&&(d.preventDefault(),d.stopPropagation())}}var c=0,e=window,f=document;return{add:function(a,f,h){a.setInterval&&a!=e&&!a.frameElement&&(a=e),h.guid||(h.guid=++c),a.events||(a.events={},a.handle=function(c){return d(g)?b.call(a,c):void 0}),a.events[f]||(a.events[f]={},a.addEventListener?a.addEventListener(f,a.handle,!1):a.attachEvent&&a.attachEvent("on"+f,a.handle)),a.events[f][h.guid]=h},remove:function(a,b,c){var d,e=a.events&&a.events[b];if(e){delete e[c.guid];for(d in e)if(e.hasOwnProperty(d))return;a.removeEventListener?a.removeEventListener(b,a.handle,!1):a.detachEvent&&a.detachEvent("on"+b,a.handle),delete a.events[b];for(d in a.events)if(a.events.hasOwnProperty(d))return;try{delete a.handle,delete a.events}catch(f){a.removeAttribute("handle"),a.removeAttribute("events")}}}}}();$AJAX=function(a){var b,c,g,h,i,j,k,l={},m=["GET","POST","PUT"],n=["json","text"],o={},p=XMLHttpRequest,q="Msxml2.XMLHTTP",r={url:a.url||!1,async:a.async||!1,data:a.data||null,crossDomain:a.crossDomain||!1,complete:a.result||function(){},timeout:a.timeout||1e4,type:(-1!==m.indexOf(a.type)?a.type:null)||"GET",dataType:(-1!==n.indexOf(a.dataType)?a.dataType:null)||"json"};if(!e(r.url)){typeof p==f&&(p=function(){try{var a=ActiveXObject}catch(b){}try{return new a(q+".6.0")}catch(b){}try{return new a(q+".3.0")}catch(b){}try{return new a(q)}catch(b){}throw new Error("This browser does not support XMLHttpRequest.")}),h=new("onload"in new p?p:XDomainRequest),g=r.url,"GET"===r.type&&r.data&&r.data.length>0&&(g=r.url+"?"+r.data.toString()),h.open(r.type,g,r.async),r.crossDomain||(o["X-Requested-With"]="XMLHttpRequest");for(b in o)o.hasOwnProperty(b)&&d(o[b])&&h.setRequestHeader(b,o[b]+"");r.data&&r.data.toString().length>0&&(h.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.data=r.data.toString());try{h.send(r.data||null)}catch(s){}if(r.async)var t=setTimeout(function(){h.abort()},r.timeout);k=function(){if(4===h.readyState)if(r.async&&clearTimeout(t),k="undefined",4!==h.readyState)h.abort();else{i=h.status,"string"==typeof h.responseText&&(l.text=h.responseText);try{j=h.statusText}catch(a){j=""}i||r.crossDomain?1223===i&&(i=204):i=l.text?200:404}l&&(i||r.crossDomain?1223===i&&(i=204):i=l.text?200:404,200===i&&("text"===r.dataType?c=l.text||"":"json"===r.dataType&&(c=JSON.parse(l.text)||""),r.complete(c,i,j,h.getAllResponseHeaders())))},r.async?4===h.readyState?setTimeout(k,20):h.onreadystatechange=k:k()}};var h={all:[],ae:[],an:[],ba:[],bt:[],ca:[],cn:[],de:[],ec:[],ee:[],id:[],il:[],jp:[],kp:[],la:[],lb:[],ly:[],mc:[],mm:[],mx:[],my:[],ng:[],nz:[],ru:[],sa:[],sb:[],so:[],sr:[],th:[],tl:[],tv:[],tw:[],us:[],vn:[],vu:[],ye:[],sortPhones:function(a,b,c){var e="mask",f="desc",g="asc",h=b==e?e:"name",i=c==f?f:g;return a.sort(function(a,b){return d(a[h])&&d(b[h])?(h===e?(a=a[h].replace(/\D+/g,""),b=b[h].replace(/\D+/g,"")):(a=a[h],b=b[h]),a>b?i==g?1:-1:b>a?i==g?-1:1:0):d(a[h])?-1:1}),a}},i={focus:function(){l.selectInstance(this).focused()},click:function(){l.selectInstance(this).focused()},keydown:function(a){var b,c,d=this,e=l,f=e.regex,g=e.selectInstance(d),h=a.which||a.keyCode,i=a.ctrlKey||a.metaKey,j=a.key?a.key:h>=96&&105>=h?String.fromCharCode(h-48):String.fromCharCode(h),k=d.value,m=g.setCaret,n=!1,o=!0;return 8===h?(b=g.getLastNum(d),f.test(k[b])===o?(g.removeChar(d,b),m(d,b,b),g.setCheckedMask(d),n):n):i===!0&&86===h?o:(c=k.indexOf("_"),-1===c?g.ifIssetNextMask()&&f.test(j)===o?o:n:f.test(j)!==o?n:void m(d,c,c+1))},keyup:function(a){var b,c,d=this,e=l,f=e.regex,g=e.selectInstance(d),h=a.keyCode||a.which,i=d.value,j=g.opt,k=g.setCaret,m=!1;return 8===h?(b=g.getLastNum(d),f.test(i[b])===!0?(b+=1,k(d,b,b),m):m):void(13===h?j.onsend&&j.onsend(j):(c=i.indexOf("_"),b=-1!==c?c:i.length,k(d,b,b),g.setCheckedMask(d)))},paste:function(a){a.preventDefault();var b=this,c=l,d=c.selectInstance(b),e=(a.originalEvent||a).clipboardData.getData("text/plain");d.opt.element.value=d.getVal(e),d.setCheckedMask(b)}},j=function(a,b){this.opt={instId:l.prefix+c(),element:a,lang:b.lang||"ru",country:b.country||"ru",phone:b.phone||!1,mask:b.mask||"",onsend:b.onsend||null,value:"",name:"",old:{}},this.init(a,this.opt)};j.prototype={init:function(b,c){var d,e,f=this;if(c.phone){var g=f.maskFinder(c.phone);g||(c.phone=!1)}f.setTemplate(),e=f.opt,d=f.opt.element,d.value=e.value,d.placeholder=e.value,a(d,e.instId),f.addActions(e.element)},maskFinder:function(a,b){var c,f,g,i=this,j=i.getVal(a+""),k=b?b:!1,m=h,n=l;return g=this.simpleFinder(j,k),g&&(f=g.obj,c=f.iso_code,d(m[c])&&e(m[c])?n.loadMasks(c,"ru",function(){g=i.simpleFinder(j,c),i.setInputAttrs(i.opt.element,g.obj.iso_code,g.obj.name,i.setNewMaskValue(j,g.mask)),i.focused(),n.loaded=!0}):i.setInputAttrs(i.opt.element,f.iso_code,f.name,i.setNewMaskValue(j,g.mask))),i.focused(),g},setCheckedMask:function(a){this.maskFinder(a.value,this.opt.country)},setInputAttrs:function(a,b,c,d){a.value=d;var f,g=this.opt;e(a.parentNode.getElementsByClassName("selected")[0])||(f=a.parentNode.getElementsByClassName("selected")[0].getElementsByClassName("flag")[0],f.className="flag "+b,f.parentNode.setAttribute("title",c)),g.country=b,g.name=c,g.value=d,g.mask=d},setTemplate:function(){var c,e,f,i,j,k,m,n,o,p,q,r,s=this,t=window,u=document,v=s.opt,w=v.element,x=l,y="lists",z="active",A="top",B=u.getElementsByClassName(y+" "+z),C=function(a){return document.createElement(a)},D=function(a,b){a.innerHTML=b.outerHTML},E=function(a,b){return a.className=b},F=h,G=function(a,b){a.appendChild(b)},H="div",I="flag";if(o=C("div"),D(o,w),E(o,"CBH-masks"),w.parentNode.replaceChild(o,w),m=C("i"),E(m,"caret"),k=C(H),D(k,m),E(k,I+" "+v.country),p=C(H),D(p,k),E(p,"selected"),q=C(H),D(q,p),E(q,"flags"),f=C("ul"),E(f,"lists"),r=F.sortPhones(F.all,"name","asc"),0!==r.length){for(c in r)if(r.hasOwnProperty(c)){var J=r[c],K=J.iso_code.toString().toLowerCase(),L=J.name,M=J.mask;if(!d(L))continue;v.phone===!1&&v.country===K&&(s.opt.name=L,s.opt.mask=M,s.opt.value=M),e=C("li"),e.className="country",e.dataset.isoCode=K,e.dataset.mask=M,g.add(e,"click",s.maskReplace),i=C("i"),E(i,I+" "+K),G(e,i),j=C("span"),E(j,"name"),j.innerHTML=L,G(e,j),j=C("span"),E(j,"code"),j.innerHTML="+"+J.phone_code,G(e,j),G(f,e)}G(q,f),g.add(f,"mousedown",function(a){a.stopPropagation()}),o.insertBefore(q,o.firstChild),o.getElementsByClassName("selected")[0].onclick=function(){if(n=o.getElementsByClassName(y)[0],B.length)for(c in B)B.hasOwnProperty(c)&&n!==B[c]&&b(B[c],z);if(/active/.test(n.className)!==!0){a(n,z);var d=t.innerHeight||u.documentElement.clientHeight||u.body.clientHeight,e=x.findPos(n),f=e.top-n.scrollTop,g=n.clientHeight;d-(f+o.childNodes[1].clientHeight)<=g&&a(n,A)}else b(n,z),b(n,A)},s.opt.element=o.childNodes[1]}},maskReplace:function(){var a,c,d=this,e=d.parentNode.parentNode,f=e.parentNode.childNodes[1],g=l,h=g.selectInstance(f),i=d.dataset,j=h.findMaskByCode(h.opt.country),k=h.findMaskByCode(i.isoCode);f.value=h.setNewMaskValue(h.getVal(f.value).replace(j.phone_code,k.phone_code),h.opt.mask.replace(new RegExp([g.regex.source].concat("_").join("|"),"g"),"_")),f.placeholder=k.mask,h.opt.value=f.value,h.opt.name=k.name,h.opt.mask=k.mask,h.opt.country=k.iso_code,a=e.childNodes[0].childNodes[0],a.className="flag "+k.iso_code,c=e.childNodes[1],b(c,"active")},addActions:function(a){g.add(a,"focus",i.focus),g.add(a,"click",i.click),g.add(a,"keydown",i.keydown),g.add(a,"keyup",i.keyup),g.add(a,"paste",i.paste)},focused:function(){var a=this,b=a.opt.element,c=b.value,d=c.indexOf("_"),e=-1===d?c.length:d;a.setCaret(b,e,e)},setCaret:function(a,b,c){var d="character";if(a.focus(),a.setSelectionRange)a.setSelectionRange(b,c);else if(a.createTextRange){var e=a.createTextRange();e.collapse(!0),e.moveEnd(d,b),e.moveStart(d,c),e.select()}},getLastNum:function(a){var b,c=a.value;for(b=c.length;b>=0&&!l.regex.test(c[b]);b--);return b},removeChar:function(a,b){var c=a.value.split("");c[b]="_",a.value=c.join("")},getVal:function(a){return a.replace(/\D+/g,"")},ifIssetNextMask:function(){var a=this,b=l,c=a.opt.country,e=h,f=a.opt.element.value,g=f.replace(new RegExp([b.regex.source].concat("_").join("|"),"g"),"_").replace(/[+()-]/g,"").length;if(d(e[c]))for(var i in e[c])if(e[c].hasOwnProperty(i)){var j=e[c][i].mask.replace(new RegExp([b.regex.source].concat("_").join("|"),"g"),"_").replace(/[0-9+()-]/g,"").length;if(j>g)return!0}return!1},simpleFinder:function(a,b){var c,f,g,i,j,k,m,n,o=[],p=!1,q=this,r=h,s=r.all,t=l.regex;s=h.sortPhones(s,"mask","desc"),e(r[b])||(s=r[b].concat(s));for(c in s)if(s.hasOwnProperty(c)){for(k=s[c].mask,m=!0,f=0,g=0;f<a.length&&g<k.length;){var u=k.charAt(g),v=a.charAt(f);if(t.test(u)||"_"===u){if(!("_"===u&&t.test(v)||v==u)){m=p;break}f++,g++}else g++}m&&f==a.length&&(n=-1==k.substr(g).search(t),k=k.replace(new RegExp([t.source].concat("_").join("|"),"g"),"_"),o.push({mask:k,obj:s[c]}))}("us"===b||"ca"===b)&&(o=h.sortPhones(o,"obj.mask","asc")),j=p;for(c in o)o.hasOwnProperty(c)&&(i=o[c].obj.mask.replace(/\D+/g,""),parseInt(i)===parseInt(a)&&(j=o[c]));return!j&&o.length>1&&o.sort(function(a,b){return Math.sign((a.mask.match(/_/g)||[]).length-(b.mask.match(/_/g)||[]).length)}),d(o[0])?j||o[0]||p:(a=a.substring(0,a.length-1))?q.simpleFinder(a,b):void 0},findMaskByCode:function(a){var b,c,d=h,e=d.sortPhones(d.all,"name",1);for(b in d.all)if(d.all.hasOwnProperty(b)&&(c=e[b],c.iso_code===a))return c;return!1},setNewMaskValue:function(a,b){var c,d,e=this.getVal(a),f=b.split(""),g=0;for(c in f)f.hasOwnProperty(c)&&(d=f[c],"_"==d&&g<e.length&&(f[c]=e[g],g++));return f.join("")}};var k={path:"//masked.proj/js/masks/",prefix:"instId_"},l={path:k.path,prefix:k.prefix,regex:new RegExp("[0-9]"),instances:[],loaded:!0,phoneCodes:h,init:function(a,b){var c,d,e,f,g=[],h=this,i=document;if("string"==typeof a)if(d=a[0],("."===d||"#"===d)&&(a=a.substr(1)),"."===d){f=i.getElementsByClassName(a);for(c in f)f.hasOwnProperty(c)&&null!==f[c]&&(g[f[c].id||c]=f[c])}else{if("#"!==d)return;f=i.getElementById(a),null!==f&&g.push(f)}else a.nodeType&&null!==a&&g.push(a);h.loaded===!1?e=setInterval(function(){h.loaded===!0&&(h.loop(g,b),clearInterval(e))},10):h.loop(g,b)},loop:function(a,b){var c,d,e,f=this;for(c in a)if(a.hasOwnProperty(c)){if(d=a[c],e=f.extend(f.extend({},b),d.dataset),0===h.all.length){f.loaded=!1,f.loadMasks("all",e.lang,function(b){return function(){f.loop(a,b)}}(e));break}f.preload(d,e)}},preload:function(a,b){var c=this,d=new j(a,b);c.instances[d.opt.instId]=d},loadMasks:function(a,b,c){var d=this,f=h,g=!0;$AJAX({url:d.path+a+"/"+(e(b)?"ru":b)+".min.json",type:"GET",async:g,crossDomain:g,dataType:"json",result:function(b){f[a]=f.sortPhones(b,"mask","desc"),"function"==typeof c&&c(k)}})},selectInstance:function(a){var b=l;return b.instances[a.className.match(new RegExp(b.prefix+"[0-9a-zA-Z]+"))]},extend:function(a,b){var c,d={},e=Object.prototype.hasOwnProperty;for(c in a)a.hasOwnProperty(c)&&e.call(a,c)&&(d[c]=a[c]);for(c in b)b.hasOwnProperty(c)&&e.call(b,c)&&(d[c]=b[c]);return d},findPos:function(a){var b=0,c=0;if(a&&a.offsetParent)do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return{left:b,top:c}},getById:function(a){var b=document.getElementById(a);return null!==b?this.selectInstance(b):!1}};return l}();