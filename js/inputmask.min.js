var CBHMasks=function(){function a(a,b){var c=a.className;new RegExp("(^|\\s)"+b+"(\\s|$)","g").test(c)||(a.className=(c+" "+b).replace(/\s+/g," ").replace(/(^ | $)/g,""))}function b(a,b){a.className=a.className.replace(new RegExp("(^|\\s)"+b+"(\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/(^ | $)/g,"")}function c(a,b){for(;(a=a.parentNode)&&a!==b;);return!!a}function d(){for(var a="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;8>c;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a}function e(){for(var a=arguments,b=a.length,c=0,d=void 0,e=""+d;c!==b;){if(a[c]===d||typeof a[c]===e||null===a[c])return!1;c++}return!0}function f(){for(var a=arguments,b=a.length,c=0,d=0,e=void 0,f=""+e,g=[e,!1,""],h=g.length;c!==b;){for(d=0;h>d;d++)if(typeof a[c]===f||a[c]===g[d]||0===a[c].length)return!0;c++}return!1}var g="undefined",h=function(){function a(a){var b=a||d.event;if(b.isFixed)return b;if(b.isFixed=!0,b.preventDefault=b.preventDefault||function(){this.returnValue=!1},b.stopPropagation=b.stopPropagation||function(){this.cancelBubble=!0},b.target||(b.target=b.srcElement),!b.relatedTarget&&b.fromElement&&(b.relatedTarget=b.fromElement==b.target?b.toElement:b.fromElement),null==b.pageX&&null!=b.clientX){var c=f.documentElement,e=f.body;b.pageX=b.clientX+(c&&c.scrollLeft||e&&e.scrollLeft||0)-(c.clientLeft||0),b.pageY=b.clientY+(c&&c.scrollTop||e&&e.scrollTop||0)-(c.clientTop||0)}return!b.which&&b.button&&(b.which=1&b.button?1:2&b.button?3:4&b.button?2:0),b}function b(b){var c,d=a(b),e=this.events[d.type];for(c in e)if(e.hasOwnProperty(c)){var f=e[c],g=f.call(this,d);g===!1&&(d.preventDefault(),d.stopPropagation())}}var c=0,d=window,f=document;return{add:function(a,f,g){a.setInterval&&a!=d&&!a.frameElement&&(a=d),g.guid||(g.guid=++c),a.events||(a.events={},a.handle=function(c){return e(h)?b.call(a,c):void 0}),a.events[f]||(a.events[f]={},a.addEventListener?a.addEventListener(f,a.handle,!1):a.attachEvent&&a.attachEvent("on"+f,a.handle)),a.events[f][g.guid]=g},remove:function(a,b,c){var d,e=a.events&&a.events[b];if(e){delete e[c.guid];for(d in e)if(e.hasOwnProperty(d))return;a.removeEventListener?a.removeEventListener(b,a.handle,!1):a.detachEvent&&a.detachEvent("on"+b,a.handle),delete a.events[b];for(d in a.events)if(a.events.hasOwnProperty(d))return;try{delete a.handle,delete a.events}catch(f){a.removeAttribute("handle"),a.removeAttribute("events")}}}}}();$AJAX=function(a){var b,c,d,h,i,j,k,l={},m=["GET","POST","PUT"],n=["json","text"],o={},p=XMLHttpRequest,q="Msxml2.XMLHTTP",r={url:a.url||!1,async:a.async||!1,data:a.data||null,crossDomain:a.crossDomain||!1,complete:a.result||function(){},timeout:a.timeout||1e4,type:(-1!==m.indexOf(a.type)?a.type:null)||"GET",dataType:(-1!==n.indexOf(a.dataType)?a.dataType:null)||"json"};if(!f(r.url)){typeof p==g&&(p=function(){try{var a=ActiveXObject}catch(b){}try{return new a(q+".6.0")}catch(b){}try{return new a(q+".3.0")}catch(b){}try{return new a(q)}catch(b){}throw new Error("This browser does not support XMLHttpRequest.")}),h=new("onload"in new p?p:XDomainRequest),d=r.url,"GET"===r.type&&r.data&&r.data.length>0&&(d=r.url+"?"+r.data.toString()),h.open(r.type,d,r.async),r.crossDomain||(o["X-Requested-With"]="XMLHttpRequest");for(b in o)o.hasOwnProperty(b)&&e(o[b])&&h.setRequestHeader(b,o[b]+"");r.data&&r.data.toString().length>0&&(h.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.data=r.data.toString());try{h.send(r.data||null)}catch(s){}if(r.async)var t=setTimeout(function(){h.abort()},r.timeout);k=function(){if(4===h.readyState)if(r.async&&clearTimeout(t),k="undefined",4!==h.readyState)h.abort();else{i=h.status,"string"==typeof h.responseText&&(l.text=h.responseText);try{j=h.statusText}catch(a){j=""}i||r.crossDomain?1223===i&&(i=204):i=l.text?200:404}l&&(i||r.crossDomain?1223===i&&(i=204):i=l.text?200:404,200===i&&("text"===r.dataType?c=l.text||"":"json"===r.dataType&&(c=JSON.parse(l.text)||""),r.complete(c,i,j,h.getAllResponseHeaders())))},r.async?4===h.readyState?setTimeout(k,20):h.onreadystatechange=k:k()}};var i={all:[],ae:[],an:[],ba:[],bt:[],ca:[],cn:[],de:[],ec:[],ee:[],id:[],il:[],jp:[],kp:[],la:[],lb:[],ly:[],mc:[],mm:[],mx:[],my:[],ng:[],nz:[],ru:[],sa:[],sb:[],so:[],sr:[],th:[],tl:[],tv:[],tw:[],ua:[],us:[],vn:[],vu:[],ye:[],sortPhones:function(a,b,c){var d="mask",f="desc",g="asc",h=b==d?d:"name",i=c==f?f:g;return a.sort(function(a,b){return e(a[h])&&e(b[h])?(h===d?(a=a[h].replace(/\D+/g,""),b=b[h].replace(/\D+/g,"")):(a=a[h],b=b[h]),a>b?i==g?1:-1:b>a?i==g?-1:1:0):e(a[h])?-1:1}),a}},j={focus:function(){m.getInst(this).focused()},click:function(){m.getInst(this).focused()},keydown:function(a){var b,c,d=this,e=m,f=e.regex,g=e.getInst(d),h=a.which||a.keyCode,i=a.ctrlKey||a.metaKey,j=a.key?a.key:h>=96&&105>=h?String.fromCharCode(h-48):String.fromCharCode(h),k=d.value,l=g.setCaret,n=!1,o=!0;return 8===h?(b=g.getLastNum(d),f.test(k[b])===o?(g.remChar(d,b),l(d,b,b),g.setMask(d),n):n):i===!0&&86===h?o:(c=k.indexOf("_"),-1===c?g.ifIssetNextMask()&&f.test(j)===o?o:n:f.test(j)!==o?n:void l(d,c,c+1))},keyup:function(a){var b,c,d=this,e=m,f=e.regex,g=e.getInst(d),h=a.keyCode||a.which,i=d.value,j=g.opt,k=g.setCaret,l=!1;return 8===h?(b=g.getLastNum(d),f.test(i[b])===!0?(b+=1,k(d,b,b),l):l):void(13===h?j.onsend&&j.onsend(j):(c=i.indexOf("_"),b=-1!==c?c:i.length,k(d,b,b),g.setMask(d)))},paste:function(a){a.preventDefault();var b=this,c=m,d=c.getInst(b),e=(a.originalEvent||a).clipboardData.getData("text/plain");d.opt.element.value=d.getVal(e),d.setMask(b)}},k=function(a,b){this.opt={listOpened:!1,instId:m.prefix+d(),element:a,lang:b.lang||"ru",country:b.country||"ru",phone:b.phone||!1,mask:b.mask||"",onsend:b.onsend||null,value:"",name:"",old:{},oldState:null},this.init(a,this.opt)};k.prototype={init:function(b,c){var d,e,f=this;if(c.phone){var g=f.maskFinder(c.phone);g||(c.phone=!1)}a(f.opt.element,f.opt.instId),f.opt.oldState=b.outerHTML,f.setTemplate(),e=f.opt,d=f.opt.element,d.value=e.value,d.placeholder=e.value,f.addActions(e.element)},maskFinder:function(a,b){var c,d,g,h=this,j=h.getVal(a+""),k=b?b:!1,l=i,n=m;return g=this.simpleFinder(j,k),g&&(d=g.obj,c=d.iso_code,e(l[c])&&f(l[c])?n.loadMasks(c,"ru",function(){g=h.simpleFinder(j,c),h.setInp(h.opt.element,g.obj.iso_code,g.obj.name,h.setNewMaskValue(j,g.mask)),h.focused(),n.loaded=!0}):h.setInp(h.opt.element,d.iso_code,d.name,h.setNewMaskValue(j,g.mask))),h.focused(),g},setMask:function(a){this.maskFinder(a.value,this.opt.country)},setInp:function(a,b,c,d){a.value=d;var e,g=this.opt;f(a.parentNode.getElementsByClassName("selected")[0])||(e=a.parentNode.getElementsByClassName("selected")[0].getElementsByClassName("flag")[0],e.className="flag "+b,e.parentNode.setAttribute("title",c)),g.country=b,g.name=c,g.value=d,g.mask=d},setTemplate:function(){var d,f,g,j,k,l,n,o,p,q,r,s,t=this,u=window,v=document,w=t.opt,x=w.element,y=m,z="lists",A="active",B="top",C="CBH-masks",D=v.getElementsByClassName(z+" "+A),E=function(a){return document.createElement(a)},F=function(a,b){a.innerHTML=b.outerHTML},G=function(a,b){return a.className=b},H=i,I=function(a,b){a.appendChild(b)},J="div",K="flag";if(p=E("div"),F(p,x),G(p,C),x.parentNode.replaceChild(p,x),n=E("i"),G(n,"caret"),l=E(J),F(l,n),G(l,K+" "+w.country),q=E(J),F(q,l),G(q,"selected"),r=E(J),F(r,q),G(r,"flags"),g=E("ul"),G(g,"lists"),s=H.sortPhones(H.all,"name","asc"),0!==s.length){for(d in s)if(s.hasOwnProperty(d)){var L=s[d],M=L.iso_code.toString().toLowerCase(),N=L.name,O=L.mask;if(!e(N))continue;w.phone===!1&&w.country===M&&(t.opt.name=N,t.opt.mask=O,t.opt.value=O),f=E("li"),f.className="country",f.dataset.isoCode=M,f.dataset.mask=O,h.add(f,"click",t.maskReplace),j=E("i"),G(j,K+" "+M),I(f,j),k=E("span"),G(k,"name"),k.innerHTML=N,I(f,k),k=E("span"),G(k,"code"),k.innerHTML="+"+L.phone_code,I(f,k),I(g,f)}I(r,g),h.add(g,"mousedown",function(a){a.stopPropagation()}),p.insertBefore(r,p.firstChild),p.getElementsByClassName("selected")[0].onclick=function(){o=p.getElementsByClassName(z)[0];var e=document,f=function(a){c(a.target,r)||(b(o,A),b(o,B),h.remove(e,"click",f))};if(D.length)for(d in D)D.hasOwnProperty(d)&&o!==D[d]&&b(D[d],A);if(/active/.test(o.className)!==!0){h.add(e,"click",f),a(o,A);var g=u.innerHeight||v.documentElement.clientHeight||v.body.clientHeight,i=y.findPos(o),j=i.top-o.scrollTop,k=o.clientHeight;g-(j+p.childNodes[1].clientHeight)<=k&&a(o,B)}else b(o,A),b(o,B),h.remove(e,"click",f)},t.opt.element=p.childNodes[1]}},maskReplace:function(){var a=this,c=a.parentNode.parentNode,d=c.parentNode.childNodes[1],e=m,f=e.getInst(d),g=a.dataset,h=f.findMaskByCode(f.opt.country),i=f.findMaskByCode(g.isoCode);f.setInp(f.opt.element,i.iso_code,i.name,f.setNewMaskValue(f.getVal(d.value).replace(h.phone_code,i.phone_code),i.mask.replace(new RegExp([e.regex.source].concat("_").join("|"),"g"),"_"))),b(c.childNodes[1],"active")},addActions:function(a){h.add(a,"focus",j.focus),h.add(a,"click",j.click),h.add(a,"keydown",j.keydown),h.add(a,"keyup",j.keyup),h.add(a,"paste",j.paste)},focused:function(){var a=this,b=a.opt.element,c=b.value,d=c.indexOf("_"),e=-1===d?c.length:d;a.setCaret(b,e,e)},setCaret:function(a,b,c){var d="character";if(a.focus(),a.setSelectionRange)a.setSelectionRange(b,c);else if(a.createTextRange){var e=a.createTextRange();e.collapse(!0),e.moveEnd(d,b),e.moveStart(d,c),e.select()}},getLastNum:function(a){var b,c=a.value;for(b=c.length;b>=0&&!m.regex.test(c[b]);b--);return b},remChar:function(a,b){var c=a.value.split("");c[b]="_",a.value=c.join("")},getVal:function(a){return a.replace(/\D+/g,"")},ifIssetNextMask:function(){var a=this,b=m,c=a.opt.country,d=i,f=a.opt.element.value,g=f.replace(new RegExp([b.regex.source].concat("_").join("|"),"g"),"_").replace(/[+()-]/g,"").length;if(e(d[c]))for(var h in d[c])if(d[c].hasOwnProperty(h)){var j=d[c][h].mask.replace(new RegExp([b.regex.source].concat("_").join("|"),"g"),"_").replace(/[0-9+()-]/g,"").length;if(j>g)return!0}return!1},simpleFinder:function(a,b){var c,d,g,h,j,k,l,n,o=[],p=!1,q=this,r=i,s=r.all,t=m.regex;s=i.sortPhones(s,"mask","desc"),f(r[b])||(s=r[b].concat(s));for(c in s)if(s.hasOwnProperty(c)){for(k=s[c].mask,l=!0,d=0,g=0;d<a.length&&g<k.length;){var u=k.charAt(g),v=a.charAt(d);if(t.test(u)||"_"===u){if(!("_"===u&&t.test(v)||v==u)){l=p;break}d++,g++}else g++}l&&d==a.length&&(n=-1==k.substr(g).search(t),k=k.replace(new RegExp([t.source].concat("_").join("|"),"g"),"_"),o.push({mask:k,obj:s[c]}))}"us"!==b&&"ca"!==b||(o=i.sortPhones(o,"obj.mask","asc")),j=p;for(c in o)o.hasOwnProperty(c)&&(h=o[c].obj.mask.replace(/\D+/g,""),parseInt(h)===parseInt(a)&&(j=o[c]));return!j&&o.length>1&&o.sort(function(a,b){return Math.sign((a.mask.match(/_/g)||[]).length-(b.mask.match(/_/g)||[]).length)}),e(o[0])?j||o[0]||p:(a=a.substring(0,a.length-1))?q.simpleFinder(a,b):void 0},findMaskByCode:function(a){var b,c,d=i,e=d.sortPhones(d.all,"name",1);for(b in d.all)if(d.all.hasOwnProperty(b)&&(c=e[b],c.iso_code===a))return c;return!1},setNewMaskValue:function(a,b){var c,d,e=this.getVal(a),f=b.split(""),g=0;for(c in f)f.hasOwnProperty(c)&&(d=f[c],"_"==d&&g<e.length&&(f[c]=e[g],g++));return f.join("")}};var l={path:"//masked.proj/js/masks/",prefix:"instId_"},m={path:l.path,prefix:l.prefix,regex:new RegExp("[0-9]"),instances:[],loaded:!0,phoneCodes:i,init:function(a,b){var c,d,e,f,g=[],h=this,i=document;if("string"==typeof a)if(d=a[0],"."!==d&&"#"!==d||(a=a.substr(1)),"."===d){f=i.getElementsByClassName(a);for(c in f)f.hasOwnProperty(c)&&null!==f[c]&&(g[f[c].id||c]=f[c])}else{if("#"!==d)return;f=i.getElementById(a),null!==f&&g.push(f)}else a.nodeType&&null!==a&&g.push(a);h.loaded===!1?e=setInterval(function(){h.loaded===!0&&(h.loop(g,b),clearInterval(e))},10):h.loop(g,b)},loop:function(a,b){var c,d,e,f=this;for(c in a)if(a.hasOwnProperty(c)){if(d=a[c],e=f.extend(f.extend({},b),d.dataset),0===i.all.length){f.loaded=!1,f.loadMasks("all",e.lang,function(b){return function(){f.loop(a,b)}}(e));break}f.preload(d,e)}},preload:function(a,b){var c=this,d=new k(a,b);c.instances[d.opt.instId]=d},loadMasks:function(a,b,c){var d=this,e=i,g=!0;$AJAX({url:d.path+a+"/"+(f(b)?"ru":b)+".min.json",type:"GET",async:g,crossDomain:g,dataType:"json",result:function(b){e[a]=e.sortPhones(b,"mask","desc"),"function"==typeof c&&c(l)}})},getInst:function(a){var b=m;return b.instances[a.className.match(new RegExp(b.prefix+"[0-9a-zA-Z]+"))]},extend:function(a,b){var c,d={},e=Object.prototype.hasOwnProperty;for(c in a)a.hasOwnProperty(c)&&e.call(a,c)&&(d[c]=a[c]);for(c in b)b.hasOwnProperty(c)&&e.call(b,c)&&(d[c]=b[c]);return d},findPos:function(a){var b=0,c=0;if(a&&a.offsetParent)do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return{left:b,top:c}},getById:function(a){var b=document.getElementById(a);return null!==b?this.getInst(b):!1},toggle:function(a){var b=this.getInst(a),c=b.opt;f(a.parentNode)||"CBH-masks"!==a.parentNode.className?(c.element=a,b.setTemplate(),c.element.value=c.value,b.addActions(c.element)):a.parentNode.outerHTML=c.oldState}};return m}();